---
title: "Day 2 Exercise Finn Qiao"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
gapminder <- read.csv(here::here("data", "gapminder5.csv"))
```

```{r}
str(gapminder)
```

## converting factors to characters
```{r}
gapminder$country <- as.character(gapminder$country)
gapminder$continent <- as.character(gapminder$continent)
str(gapminder)
```

```{r}
obs <- 1:nrow(gapminder)

for (i in obs) {
  gapminder[i,'gdp'] <- gapminder[i,'pop'] * gapminder[i,'gdpPercap']
}
```

## creating logged variables with a for loop
```{r}
for (i in obs) {
  gapminder[i, 'log_gdpPercap'] <- log(gapminder[i,'gdpPercap'])
  gapminder[i, 'log_pop'] <- log(gapminder[i,'pop'])
}
```

```{r}
years <- unique(gapminder$year)

for (i in years) {
  mean_le <- mean(gapminder$lifeExp[gapminder$year == i],
                  na.rm = T)
  print(paste0(i, ': ', mean_le))
}
```

```{r}
continents <- unique(gapminder$continent)

for (i in continents) {
  mean_cont <- mean(gapminder$lifeExp[gapminder$continent == i], 
                    na.rm = T)
  print(paste0(i, ': ', mean_cont))
}
```

```{r}
for (i in continents) {
  print(paste0('Continent: ', i))
  for (j in years) {
    mean_le <- mean(gapminder$lifeExp[gapminder$continent == i & gapminder$year == j], na.rm = T)
    print(paste0(j, ": ", mean_le))
  }
}
```

## double for loop
```{r}
for (i in continents) {
  print(paste0('Continent: ', i))
  for (j in years) {
    mean_le <- sd(gapminder$lifeExp[gapminder$continent == i & gapminder$year == j], na.rm = T)
    print(paste0(j, ": ", mean_le))
  }
}
```

## apply, lapply, sapply
```{r}
vars <- gapminder[, c("lifeExp", "pop", "gdpPercap")]
apply(vars, 2, mean)
```

```{r}
lapply(gapminder, mean)
```

```{r}
sapply(gapminder, mean)
```

```{r}
sapply(years, function(x) mean(gapminder$lifeExp[gapminder$year == x]))
```

```{r}
i <- 1952

while (i < 1987) {
  sd_le <- sd(gapminder$lifeExp[gapminder$year == i])
  print(paste0(i, ": ", sd_le))
  i <- i+5
}
```

```{r}
i <- 1987

while (i <= 2002) {
  sd_le <- sd(gapminder$lifeExp[gapminder$year == i])
  print(paste0(i, ": ", sd_le))
  i <- i+5
}
```

```{r}
year_lim <- 1987

for (i in unique(gapminder$year)){
  if (i >= year_lim) {
    mean_pop <- mean(gapminder$pop[gapminder$year == i])
    print(paste0(i, ": ", mean_pop))
  }
  else {
    print("Condition not met!")
  }
}
```

```{r}
getvalues <-
  function(df, variable = "continent") {
    vals <- unique(df[[variable]])
    print(paste0(variable, ': ', vals))
  }
```

```{r}
report_mean_sd <- 
  function(df, variable, country) {
    var <- gapminder[[variable]][gapminder$country == country]
    m_le <- mean(var)
    sd_le <- sd(var)
    cat("Country: ", country,
        "\nMean Life Expectancy: ", m_le,
        "\nSD Life Expectancy: ", sd_le)
  }

report_mean_sd(gapminder, "lifeExp", "Albania")
```

```{r}
report_stuff <-
  function(df, variable, continent) {
    var <- gapminder[[variable]][gapminder$continent == continent]
    mean_cont <- mean(var) 
    median_cont <- median(var)
    min_cont <- min(var)
    max_cont <- max(var)
    cat("Continent: ", continent,
        "\nMean: ", mean_cont,
        "\nMedian: ", median_cont,
        "\nMin: ", min_cont,
        "\nMax: ", max_cont
    )
  }

report_stuff(gapminder, "lifeExp", "Asia")
```

```{r}
viz_lm <- 
  function(df, dv, iv, year) {
    dat <- df[df[["year"]] == year, ]
    y <- log(dat[[dv]])
    x <- log(dat[[iv]])
    fit <- lm(y~x)
    plot(y ~ x, main = year, xlab = iv, ylab = dv)
    lines(x, predict(fit), col = "blue")
  }
```

```{r}

```

```{r}

```

```{r}

```

```{r}

```

```{r}

```

## Load the data

Load the `gapminder` dataset.

```{r}
### Answer

```

```{r}
gapminder <- read.csv(here::here("data/gapminder5.csv"), stringsAsFactors=FALSE)
```


## If Statement

Use an if() statement to print a suitable message reporting whether there are any records from 2002 in the gapminder dataset. Now do the same for 2012.

Hint: use the `any` function.

```{r}
### Answer
if (any(gapminder$year == 2002)) cat("There are records from 2002")

if (any(gapminder$year == 2012)) cat("There are records from 2012")
```

```{r}
year<-2002
if(any(gapminder$year == year)){
   print(paste("Record(s) for the year",year,"found."))
} else {
  print(paste("No records for year",year))
}
```


## Loop and If Statements

Write a script that finds the mean life expectancy by country for countries whose population is below the mean for the dataset

Write a script that loops through the `gapminder` data by continent and prints out whether the mean life expectancy is smaller than 50, between 50 and 70, or greater than 70.

```{r}
### Answer
for (i in unique(gapminder$country)){
  if (mean(gapminder$pop[gapminder$country == i]) < mean(gapminder$pop)){
    print(paste0(i, ": ", mean(gapminder$pop[gapminder$country == i])))
  }
}

for (i in unique(gapminder$continent)) {
  cont_mean = mean(gapminder$lifeExp[gapminder$continent == i])
  if (cont_mean < 50) print(paste0(i, " is smaller than 50"))
  else if (cont_mean <= 70) print(paste0(i, " is between 50 and 70"))
  else print(paste0(i, " is above 70"))
}
```

```{r}
overall_mean <- mean(gapminder$pop)

for (i in unique(gapminder$country)) {
   country_mean <- mean(gapminder$pop[gapminder$country==i])
   
   if (country_mean < overall_mean) {
     mean_le <- mean(gapminder$lifeExp[gapminder$country==i])
     print(paste("Mean Life Expectancy in", i, "is", mean_le))
   } 
} # end for loop
```

```{r}
lower_threshold <- 50
upper_threshold <- 70
 
for (i in unique(gapminder$continent)){
    tmp <- mean(gapminder$lifeExp[gapminder$continent==i])
    
    if (tmp < lower_threshold){
        print(paste("Average Life Expectancy in", i, "is less than", lower_threshold))
    }
    else if (tmp > lower_threshold & tmp < upper_threshold){
        print(paste("Average Life Expectancy in", i, "is between", lower_threshold, "and", upper_threshold))
    }
    else {
        print(paste("Average Life Expectancy in", i, "is greater than", upper_threshold))
    }
   
}
```


## Exercise: Write Functions

Create a function that given a data frame will print the name of each column and the class of data it contains. Use the gapminder dataset.  Hint: Use `mode()` or `class()` to get the class of the data in each column. Remember that `names()` or `colnames()` returns the name of the columns in a dataset.

```{asis}
### Answer

Note: Some of these were taken or modified from https://www.r-bloggers.com/functions-exercises/
```

```{r}
data_frame_info <- function(df) {
  cols <- names(df)
  for (i in cols) {
    print(paste0(i, ": ", mode(df[, i])))
  }
}
data_frame_info(gapminder)
```

Create a function that given a vector will print the mean and the standard deviation of a **vector**, it will optionally also print the median. Hint: include an argument that takes a boolean (`TRUE`/`FALSE`) operator and then include an `if` statement.

```{r}
### Answer
vec_mean <- 
  function(vec, include_median=FALSE){
    vec_mean <- mean(vec)
    vec_sd <- sd(vec)
    vec_median <- median(vec)
    if (include_median == TRUE) {
      return(cat("mean: ", vec_mean,
                 "\nstandard deviation: ", vec_sd),
                 "\nmedian: ", vec_median)
    }
    else {
      return(cat("mean: ", vec_mean,
                 "\nstandard deviation: ", vec_sd))
    }
  }
```

```{r}
vector_info <- function(x, include_median=FALSE) {
  print(paste("Mean:", mean(x)))
  print(paste("Standard Deviation:", sd(x)))
  if (include_median) {
    print(paste("Median:", median(x)))
  }
}

le <- gapminder$lifeExp
vector_info(le, include_median = F)
vector_info(le, include_median = T)
```

## Analyzing the relationship 

Use what you've learned so far to answer the following questions using the `gapminder` dataset. Be sure to include some visualizations!

1. What is the relationship between GDP per capita and life expectancy? Does this relationship change over time? (Hint: Use the natural log of both variables.)

```{r}
print(mean(gapminder$gdpPercap))
print(mean(gapminder$lifeExp))

plot(log(gapminder$gdpPercap) ~ log(gapminder$lifeExp))
```
```{r}
for (i in unique(gapminder$year)){
  plot(log(gapminder$gdpPercap[gapminder$year == i]) ~ log(gapminder$lifeExp)[gapminder$year == i])
}
```

The relationship seems to get stronger over the years. The slope gets steeper and there is a more concentrated cluster.

2. Does the relationship between GDP per capita and life expectacy vary by continent? Make sure you divide the Americas into North and South America.

```{r}
for (i in unique(gapminder$continent)){
  plot(log(gapminder$gdpPercap[gapminder$continent == i]) ~ log(gapminder$lifeExp)[gapminder$continent == i], main = i)
}
```

There isn't a strong relationship for Africa and the Americas. The relationship is more linear for Europe and Oceania.
